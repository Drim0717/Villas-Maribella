<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - Villas Maribella</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="../style.css">
</head>

<body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h1><img src="../images/Logo.png" alt="Villas Maribella" class="logo-image"></h1>
            <h2>Panel de Administraci√≥n</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="adminPassword">Contrase√±a:</label>
                    <input type="password" id="adminPassword" placeholder="Ingresa la contrase√±a" required>
                </div>
                <button type="submit" class="login-btn">Iniciar Sesi√≥n</button>
            </form>
        </div>
    </div>

    <!-- ADMIN DASHBOARD -->
    <div id="adminDashboard" class="admin-dashboard" style="display: none;">
        <!-- HEADER -->
        <header class="admin-header">
            <div class="header-content">
                <h1><img src="../images/Logo.png" alt="Villas Maribella" class="logo-image-admin"> Panel de
                    Administraci√≥n
                </h1>
                <div class="header-actions">
                    <button onclick="refreshData()" class="refresh-btn">üîÑ Actualizar</button>
                    <button onclick="logout()" class="logout-btn">Cerrar Sesi√≥n</button>
                </div>
            </div>
        </header>

        <!-- STATISTICS -->
        <section class="stats-section">
            <div class="stat-card">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-content">
                    <h3 id="totalReservations">0</h3>
                    <p>Total Reservas</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-content">
                    <h3 id="totalRevenue">$0</h3>
                    <p>Ingresos Totales</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üè†</div>
                <div class="stat-content">
                    <h3 id="occupancyRate">0%</h3>
                    <p>Ocupaci√≥n</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üö´</div>
                <div class="stat-content">
                    <h3 id="blockedDaysCount">0</h3>
                    <p>D√≠as Bloqueados</p>
                </div>
            </div>
        </section>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('reservations')">üìã Reservas</button>
            <button class="tab-btn" onclick="switchTab('calendarView')">üìÜ Calendario de Ocupaci√≥n</button>
            <button class="tab-btn" onclick="switchTab('calendar')">üìÖ Bloquear Fechas</button>
        </div>

        <!-- RESERVATIONS TAB -->
        <section id="reservationsTab" class="tab-content active">
            <div class="section-header">
                <h2>Lista de Reservas</h2>
                <div class="filter-controls">
                    <select id="monthFilter" class="month-filter">
                        <option value="">Todos los meses</option>
                        <option value="2026-01">Enero 2026</option>
                        <option value="2026-02">Febrero 2026</option>
                        <option value="2026-03">Marzo 2026</option>
                        <option value="2026-04">Abril 2026</option>
                        <option value="2026-05">Mayo 2026</option>
                        <option value="2026-06">Junio 2026</option>
                        <option value="2026-07">Julio 2026</option>
                        <option value="2026-08">Agosto 2026</option>
                        <option value="2026-09">Septiembre 2026</option>
                        <option value="2026-10">Octubre 2026</option>
                        <option value="2026-11">Noviembre 2026</option>
                        <option value="2026-12">Diciembre 2026</option>
                    </select>
                    <div class="checkbox-wrapper" style="display: inline-flex; align-items: center; margin-left: 10px;">
                        <input type="checkbox" id="showPastReservations" style="width: auto; margin-right: 5px;">
                        <label for="showPastReservations" style="font-size: 0.9rem; color: #666; cursor: pointer;">Ver
                            pasadas</label>
                    </div>
                    <button onclick="showAddReservation()" class="add-btn">+ Agregar Reserva Manual</button>
                </div>
            </div>
            <div class="table-container">
                <table id="reservationsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Villa</th>
                            <th>Hu√©sped</th>
                            <th>Email</th>
                            <th>Check-in</th>
                            <th>Check-out</th>
                            <th>Noches</th>
                            <th>D√≠as Restantes</th>
                            <th>Personas</th>
                            <th>Total</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="reservationsBody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- CALENDAR VIEW TAB -->
        <section id="calendarViewTab" class="tab-content">
            <div class="section-header">
                <h2>üìÜ Calendario de Ocupaci√≥n</h2>
                <div class="calendar-filters">
                    <select id="calendarVillaFilter" class="villa-filter"
                        style="padding: 5px; border-radius: 4px; border: 1px solid #ddd;">
                        <option value="all">Todas las Villas</option>
                        <option value="1">Villa #1</option>
                        <option value="2">Villa #2</option>
                        <option value="3">Villa #3</option>
                        <option value="4">Villa #4</option>
                        <option value="5">Villa #5</option>
                        <option value="6">Villa #6</option>
                    </select>
                </div>
            </div>
            <div class="calendar-container">
                <div class="calendar-navigation">
                    <button onclick="changeMonth(-1)" class="nav-btn">‚Üê Anterior</button>
                    <h3 id="currentMonthYear"></h3>
                    <button onclick="changeMonth(1)" class="nav-btn">Siguiente ‚Üí</button>
                </div>
                <div id="calendarGrid" class="calendar-grid">
                    <!-- Populated by JavaScript -->
                </div>
                <div class="calendar-legend">
                    <div class="legend-item">
                        <span class="legend-color available"></span>
                        <span>Disponible</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color occupied"></span>
                        <span>Ocupado</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color blocked"></span>
                        <span>Bloqueado</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- CALENDAR BLOCKING TAB -->
        <section id="calendarTab" class="tab-content">
            <div class="section-header">
                <h2>Gesti√≥n de Disponibilidad</h2>
            </div>
            <div class="calendar-blocking">
                <div class="block-form">
                    <h3>Bloquear Nuevas Fechas</h3>
                    <form id="blockDatesForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="blockStartDate">Fecha Inicio:</label>
                                <input type="date" id="blockStartDate" required>
                            </div>
                            <div class="form-group">
                                <label for="blockEndDate">Fecha Fin:</label>
                                <input type="date" id="blockEndDate" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="blockReason">Motivo:</label>
                            <input type="text" id="blockReason" placeholder="Ej: Mantenimiento, Evento privado"
                                required>
                        </div>
                        <button type="submit" class="block-btn">Bloquear Fechas</button>
                    </form>
                </div>
                <div class="blocked-dates-list">
                    <h3>Fechas Bloqueadas Actualmente</h3>
                    <div id="blockedDatesList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- EDIT MODAL -->
    <div id="editModal" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <h3>Editar Reserva</h3>
                <form id="editForm">
                    <input type="hidden" id="editReservationId">
                    <div class="form-group">
                        <label>Nombre del Hu√©sped:</label>
                        <input type="text" id="editGuestName" required>
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="editGuestEmail" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Check-in:</label>
                            <input type="date" id="editCheckIn" required>
                        </div>
                        <div class="form-group">
                            <label>Check-out:</label>
                            <input type="date" id="editCheckOut" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>N√∫mero de Personas:</label>
                        <input type="number" id="editNumGuests" min="1" max="4" required>
                    </div>
                    <div class="form-group">
                        <label>Estado de la Reserva:</label>
                        <select id="editStatus" class="status-select" required>
                            <option value="confirmed">Confirmada</option>
                            <option value="pending">Pendiente</option>
                            <option value="cancelled">Cancelada</option>
                        </select>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="save-btn">Guardar Cambios</button>
                        <button type="button" onclick="closeEditModal()" class="cancel-btn">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- File protocol detection and warning -->
    <script>
        // Detect if page is opened via file:// protocol
        if (window.location.protocol === 'file:') {
            // Create warning banner
            const warningBanner = document.createElement('div');
            warningBanner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
                color: white;
                padding: 15px 20px;
                text-align: center;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: 14px;
                font-weight: 600;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideDown 0.3s ease-out;
            `;
            warningBanner.innerHTML = `
                ‚ö†Ô∏è <strong>ADVERTENCIA:</strong> Esta p√°gina debe abrirse con un servidor local (como Live Server en VS Code) para que funcione correctamente. 
                Los m√≥dulos JavaScript est√°n bloqueados por seguridad cuando se abre directamente desde archivos.
            `;
            document.body.insertBefore(warningBanner, document.body.firstChild);
        }
    </script>

    <script type="module" src="admin.js"></script>
</body>

</html>